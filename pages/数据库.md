- 数据库基础
  collapsed:: true
	- 事务
	  collapsed:: true
		- 定义
			- 把多条语句作为一个整体进行操作的功能，被称为数据库事务。
			- 数据库事务可以确保该事务范围内的所有操作都可以全部成功或者全部失败。如果事务失败，那么效果就和没有执行这些SQL一样，不会对数据库数据有任何改动。
		- 四大特性
			- 原子性-Atomic
			  collapsed:: true
				- 表示组成一个事物中的多个数据库操作是一个不可分割的原子单元，作为原子工作单元执行，要么全部执行，要么全部不执行。
			- 一致性-Consistent
			  collapsed:: true
				- 事务完成后，数据库所处的状态与它的业务规则是一致的，即A账户转账100元到B账户，无论成功与否，A账户和B账户的存款总额是不变的。
			- 隔离性-Isolation
			  collapsed:: true
				- 如果有多个事务并发执行，每个事务作出的修改必须与其他事务隔离。
			- 持久性-Duration
			  collapsed:: true
				- 事务完成后，对数据库数据的修改被持久化存储。
		- 具体实现
			- 数据库采用**重执行日志**来保证原子性、一致性和持久性。
			- 数据库采用数据库**锁机制**保证事务的隔离性。Oracle数据库还采用了数据版本的机制去保证隔离性。
	- 数据并发导致的问题
	  collapsed:: true
		- 3类数据读问题
			- 脏读（dirty read）
			  id:: 642d322f-4f72-4c9b-875c-2fcc8d125514
				- A事务读取了B事务尚未提交的更改数据，A事务并在此基础上做了操作。
				- 就是说A事务读了错的数据，并进行了操作，然后A事务提交事务后修改的数据也是错的。
			- 不可重复读（unrepeatable read）
				- A事务第一次读取了数据
				- B事务已经提交了事务，更改了数据（更新或是删除）
				- A事务第二次读取数据，发现与第一次读取的不一样
			- 幻象读
				- A事务第一次读取了数据
				- B事务已经提交了事务，新增了数据（新增）
				- A事务第二次读取数据，发现与第一次读取的不一样
			- 不可重复读和幻象读的区别
				- 一幻象读一般发生在计算统计数据的事务中
				- 二幻象度是另一个事务进行了**新增数据**的操作，而不可重复读是进行了**数据更新和删除**的操作
				- 三采取的解决策略不同
					- 幻象读，需要防止事务读到新增数据，需要添加表级锁，也就是将整张表锁定，防止新增数据。
					- 不可重复读，需要防止事务读到更改的数据，只需对操作的数据添加行级锁，阻止操作的数据发生变化
		- 2类数据更新问题
			- 第一类丢失问题
			  collapsed:: true
				- A事务第一次读取了数据
				- B事务第一次读取了数据，并对数据进行了更新操作，并提交了事务
				- A事务根据第一次读到的数据对其进行了更新操作
				- A事务**撤销了更新操作**，数据恢复为事务A第一次读到的数据
				- 在上述过程中A事物撤销时，将已经提交的B事务的更新数据给覆盖了
			- 第二类丢失问题
			  collapsed:: true
				- A事务第一次读取了数据
				- B事务第一次读取了数据，并对数据进行了更新操作，并提交了事务
				- **A事务根据第一次读到的数据对其进行了更新操作，并提交了事务**
				- 在上述过程中A事物覆盖了B事务已经提交的数据，造成B事物所做操作丢失
	- 数据库的隔离级别
	  collapsed:: true
		- 读未提交（READ UNCOMMITTED）
		- 读提交 （READ COMMITTED）
		- 可重复读 （REPEATABLE READ）
		- 串行化 （SERIALIZABLE）
		- 参考文章
			- [MySQL事务隔离级别和实现原理（看这一篇文章就够了！）](https://zhuanlan.zhihu.com/p/117476959)
	- 数据库锁机制
	  collapsed:: true
		- 参考文章
			- [MySql: 表级锁、行级锁、共享锁、排他锁、乐观锁、悲观锁](https://blog.csdn.net/hanchao5272/article/details/98607314)
- MySQL数据手册
  collapsed:: true
	- 资料信息
		- [MySQL 8.0 Reference Manual](https://dev.mysql.com/doc/refman/8.0/en/features.html)
	- 一般信息
		- 1.2 MySQL 数据库管理系统概述
			- [什么是MySQL](https://dev.mysql.com/doc/refman/8.0/en/what-is-mysql.html)
			  collapsed:: true
				- MySQL是一个数据库管理系统
				- MySQL是一个关系型数据库
				- MySQL是开源的
				- MySQL 数据库服务器非常快速，可靠，可伸缩，易于使用的
				- MySQL 服务器工作在客户端/服务器或嵌入式系统中
				- 有很多应用程序和编程语言支持MySQL
			- [MySQL的主要功能](https://dev.mysql.com/doc/refman/8.0/en/features.html)
			  collapsed:: true
				- 数据类型
				- 语句和函数
				  collapsed:: true
					- 1.支持在SELECT查询参数和WHERE子句中使用运算符和函数。
					- 2.完全支持 SQL GROUP BY 和 ORDER BY 子句。 支持组函数（COUNT()、AVG()、STD()、SUM()、MAX()、MIN() 和 GROUP_CONCAT()）。
					- 3.支持使用标准 SQL 和 ODBC 语法的 LEFT OUTER JOIN 和 RIGHT OUTER JOIN。
					- 4.支持标准 SQL 要求的表和列的别名。
					- 5.支持 DELETE、INSERT、REPLACE 和 UPDATE 以返回更改（受影响）的行数，或通过在连接到服务器时设置标志来返回匹配的行数。
					- 6.支持检索有关数据库、存储引擎、表和索引的信息的 MySQL 特定 SHOW 语句。 支持 INFORMATION_SCHEMA 数据库，根据标准 SQL 实现。
					- 7.EXPLAIN 语句显示优化器如何解析查询。
					- 8.函数名称与表或列名称的独立性。比如：命名不能与保留字重合、函数名与后面(之间不能有空格。
					- 9.可以在同一语句中引用来自不同数据库的表。
				- 安全
				  collapsed:: true
					- 一个非常灵活和安全的权限和密码系统，并且支持基于主机的验证。
					- 当您连接到服务器时，通过加密所有密码流量来实现密码安全性。
				- 可扩展性和限制
				  collapsed:: true
					- 支持大型数据库
					- 每个表最多支持 64 个索引。 每个索引可能由 1 到 16 列或部分列组成。 InnoDB 表的最大索引宽度为 767 字节或 3072 字节。MyISAM 表的最大索引宽度为 1000 字节。索引可以使用 CHAR、VARCHAR、BLOB 或 TEXT 列类型的列前缀。
				- 连通性
				  collapsed:: true
					- 客户端可以使用多种协议连接到 MySQL 服务器：
						- 客户端可以在任何平台上使用 TCP/IP 套接字进行连接。
						- 在 Windows 系统上，如果服务器在启用 named_pipe 系统变量的情况下启动，则客户端可以使用**命名管道**进行连接。 如果在启用 shared_memory 系统变量的情况下启动，Windows 服务器也支持**共享内存**连接。 客户端可以使用 --protocol=memory 选项通过共享内存进行连接。
						- 在 Unix 系统上，客户端可以使用 Unix 域**套接字文件**进行连接。
					- MySQL 客户端程序可以用多种语言编写。
					- Connector/ODBC (MyODBC) 为使用 ODBC（开放式数据库连接）连接的客户端程序提供 MySQL 支持。
					- Connector/J 接口为使用 JDBC 连接的 Java 客户端程序提供 MySQL 支持。
					- MySQL Connector/NET 使开发人员能够轻松创建需要与 MySQL 进行安全、高性能数据连接的 .NET 应用程序。
				- 本土化
					- 服务器可以用多种语言向客户端提供错误消息。
					- 完全支持多种不同的字符集，包括 latin1 (cp1252)、german、big5、ujis、多种 Unicode 字符集等。
					- 所有数据都按所选数据集进行保存。
					- 根据默认的字符集和排序规则进行排序和比较。
					- 服务器时区可以动态更改，各个客户端可以指定自己的时区。
				- 客户端和工具
					- MySQL 包括几个客户端和实用程序。 其中包括命令行程序（例如 mysqldump 和 mysqladmin）和图形程序（例如 MySQL Workbench）。
					- MySQL Server 内置支持 SQL 语句来检查、优化和修复表。 这些语句可通过 mysqlcheck 客户端从命令行获得。 MySQL 还包括 myisamchk，这是一个非常快速的命令行实用程序，用于在 MyISAM 表上执行这些操作。
					- MySQL 程序可以用 --help 或 -? 获得在线帮助的选项。
- MySQL
  collapsed:: true
	- 查看数据库隔离级别
		- 脚本如下
		  ```mysql
		  # MySQL 8.0 之前
		  SELECT @@global.tx_isolation;
		  SELECT @@session.tx_isolation;
		  SELECT @@tx_isolation;
		  
		  # MySQL8.0
		  SELECT @@global.transaction_isolation;
		  SELECT @@session.transaction_isolation;
		  SELECT @@transaction_isolation;
		  ```
	- SQL
	  collapsed:: true
		- 查看建表结构：`show create table <表名>`
		- explain关键字的使用          
		  collapsed:: true
			- 参考文档
				- https://dev.mysql.com/doc/refman/5.7/en/explain-output.html
			- type              
			  
			    > 这是最重要的字段之一，显示查询使用了何种类型。从最好到最差的连接类型依次为：system，const，eq_ref，ref，fulltext，ref_or_null，index_merge，unique_subquery，index_subquery，range，index，ALL
			- system
		- between and日期包含范围边界的查询
		  collapsed:: true
			- 针对datetime和timestamp类型，
			- 针对date类型，
		- 游标-Cursor
		  collapsed:: true
			- 背景
				- MySQL执行检索操作会返回一组称为结果集的行，这组返回的行都是与SQL 语句相匹配的行（零行或多行），但是，使用简单的select 语句，没有办法得到第一行、下一行、或前十行，也不存在一行地处理所有行简单方法（也就是成批地处理它们）,而有时，需要在检索出来的行中前进或后退一行或多行，怎么办来
			- 定义：游标（cursor）是一个存储在mysql服务器上数据库查询，它不是一条select 语句，而是被语句检索出来的结果集。
			- 好处：在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。
			- 主要用于：交互式应用，其中用户需要滚动屏幕上的数据，并对数据进行浏览或做出更改。
		- Select查询
		  collapsed:: true
			- MySQL将 select 查询分为简单查询和复杂查询。复杂查询分为三类：**简单子查询**、**派生表（from语句中的子查询）**、**union 查询**。
		- explain的使用
		  collapsed:: true
			- id列
			  collapsed:: true
				- 定义：id列的编号是 select 的序列号，有几个 select 就有几个id，并且id的顺序是按 select 出现的顺序增长的。
			- select_type列
			  collapsed:: true
				- 定义：select_type 表示对应行是是简单还是复杂的查询。
				- 类型
					- `simple`：简单查询。查询不包含子查询和union。
					- `primary`：复杂查询中最外层的 select。
					- `subquery`：包含在 select 中的子查询（不在 from 子句中）。
					- `derived`：包含在 from 子句中的子查询。MySQL会将结果存放在一个临时表中，也称为派生表（derived的英文含义）
						- 例子：用这个例子来了解 primary、subquery 和 derived 类型
							- SQL：`explain select (select 1 from actor where id = 1) from (select * from film where id = 1) der;`
								- `primary`指的就是第一个select
								- `subquery`指的是(select 1 from actor where id = 1)子查询
								- `derived`指的是(select * from film where id = 1)子查询
					- `union`：在 union 中的第二个和随后的 select
					- `union result`：从 union 临时表检索结果的 select
			- table列
			  collapsed:: true
				- 定义：这一列表示 explain 的一行正在访问哪个表。
				- 类型
					- 当 `from`子句中有子查询时，table列是 `<derivenN>` 格式，表示当前查询依赖 id=N 的查询，于是先执行 id=N 的查询。
					- 当有 `union` 时，`UNION RESULT` 的 table 列的值为 <union1,2>，1和2表示参与 union 的 select 行id。
			- type列
			  collapsed:: true
				- 定义：这一列表示关联类型或访问类型，即MySQL决定如何查找表中的行。
				- 从最优到最差分别为：`system` > `const` > `eq_ref` > `ref` > `fulltext` > `ref_or_null` > `index_merge` > `unique_subquery` > `index_subquery` > `range` > `index` > `ALL`
				- 类型
					- `NULL`：mysql能够在优化阶段分解查询语句，在执行阶段用不着再访问表或索引。
					- `system`：表中只有一行数据或者是空表，这是const类型的一个特例。且只能用于myisam和memory表。如果是Innodb引擎表，type列在这个情况通常都是all或者index
					- `const`：最多只有一行记录匹配。当联合主键或唯一索引的所有字段跟常量值比较时，join类型为const。其他数据库也叫做唯一索引扫描。
	- 索引
		- 聚集索引（聚簇索引）
			- 定义
				- 指索引项的排序方式和表中数据记录排序方式一致的索引。（以InnoDB聚集索引的主键索引来说，叶子节点中存储的就是行数据，行数据在物理储器中的真实地址就是按照主键索引树形成的顺序进行排列的）
				- 聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。术语“聚簇”表示数据行和相邻的键值紧凑的存储在一起。
				- 聚集索引的顺序就是数据的物理存储顺序。它会根据聚集索引键的顺序来存储表中的数据，即对表的数据按索引键的顺序进行排序，然后重新存储到磁盘上。因为数据在物理存放时只能有一种排列方式，所以一个表只能有一个聚集索引。
			- 特点
				- 因为在物理内存中的顺序只能有一种，所以聚集索引在一个表中只能有一个。
			- 优点
				- 查询效率快
			- 缺点
				- 修改数据慢
		- 非聚集索引
			- 定义：索引顺序与物理存储顺序不同
	- 运维相关
		- MySQL配置中`bind-address = 127.0.0.1`的坑
			- `bind-address = 127.0.0.1`的含义就是说mysql只接受localhost，不接受远程连接。在bind-address后面增加远程访问IP地址或者禁掉这句话就可以让远程机登陆访问了。
		- 重启mysql：`service mysql restart`
		- 写入MySQL报错超出 `max_allowed_packet` 的问题
			- MySQL根据配置文件会限制Server接受的数据包大小。有时候大的插入和更新会受 `max_allowed_packet` 参数限制，导致大数据写入或者更新失败。
			- 查看sql：`select @@max_allowed_packet;`
	- JDBC
		- URL参数配置
		  collapsed:: true
			- 示例：`jdbc:mysql://localhost:3306/test?user=root&password=&serverTimezone=Aisa/Shanghai`
			- 参考文章
				- [MySQL JDBC URL参数（转）](https://www.cnblogs.com/EasonJim/p/7659475.html)
				- [mysql官方文档-Configuration Properties](https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-configuration-properties.html)
		- 开发问题
		  collapsed:: true
			- `no suitable driver found for jdbc`在IDEA中使用Tocmat该如何解决
				- 第一步将mysql-connector-java的包放到tomcat的lib目录下，看问题是否解决
				- 若还不行，则看tomcat版本支持的mysql驱动的版本是不是错的，可以看这个[JNDI Datasource How-To](https://tomcat.apache.org/tomcat-8.5-doc/jndi-datasource-examples-howto.html)
	- MySQL的相关问题
		- [Mac解决 Can‘t connect to local MySQL server through socket ‘/tmp/mysql.sock‘ (2)问题](https://blog.csdn.net/cxclll/article/details/116024881)
- H2
  collapsed:: true
	- 参考文章
		- [H2 数据库使用简介](https://www.cnblogs.com/cnjavahome/p/8995650.html)
- 《MySQL 是怎样运行的：从根儿上理解 MySQL》
	- 第一章 重新认识MySQL
		- 1.启动MySQL的服务器程序
		  collapsed:: true
			- Unix中启动
			  collapsed:: true
				- mysqld
				  collapsed:: true
					- mysqld是一个可执行文件。
					- 在控制台直接输入`mysqld`命令，会直接在控制台上运行MySQL服务。
				- mysqld_safe
				  collapsed:: true
					- `mysqld_safe`是一个启动脚本。
					- 它间接调用了mysqld，它还包括了一个监控进程，如果mysql服务挂了的话可以帮忙重启服务。
					- 此外它会将服务启动时的出错信息保存到出错日志里，方便排查。
				- mysql.server
				  collapsed:: true
					- mysql.server也是一个启动脚本
					- 它会间接调用mysqld_safe。
					- 后面指定`start`参数就可以启动服务器程序，关闭程序可以使用`stop`参数。
				- mysqld_multi
				  collapsed:: true
					- 一台计算机上也可以运行多个服务器实例，也就是运行多个MySQL服务器进程。`mysql_multi`可执行文件可以对每一个服务器进程的启动或停止进行监控。
			- Windows中启动
			  collapsed:: true
				- mysqld
				  collapsed:: true
					- 在windows中MySql的安装目录下也有一个mysqld的可执行文件，双击该文件就可以启动MySQL服务器程序了。
				- 以服务的方式运行服务器程序
				  collapsed:: true
					- 使用命令`mysqld的路径 --install [-manual] [服务名]`来将MySQL作为windows的一个服务。例子`"C:\Program Files\MySQL\MySQL Server 5.7\bin\mysqld" --install`
					- `--manual`命令可以省略，加上它的话，windows系统启动的时候就不会自动启动MySQL的服务了。
					- 将MySQL注册为服务之后，我们可以使用命令`net start MySQL`来启动服务了，接着使用`net stop MySQL`来关闭服务。
		- 2.启动MySQL的客户端程序
		  collapsed:: true
			- 可以使用`mysql -h主机名  -u用户名 -p密码`启动客户端来连接服务器端。
		- 3.客户端和服务器端的连接过程
		  collapsed:: true
			- 运行着的服务器程序和客户端程序本质上都是计算机上的一个进程，所以客户端进程向服务器进程发送请求并得到回复的过程本质上是一个进程间通信的过程。
			- MySQL支持下面三种客户端进程和服务器进程的通信方式
			  id:: 64a6b818-7479-426a-a175-fa24189a58ef
				- TCP/IP
				  collapsed:: true
					- 数据库服务器进程和客户端进程可能运行在不同的主机中，它们之间必须通过网络来进行通讯。`MySQL`采用`TCP`作为服务器和客户端之间的网络通信协议。
					- 在网络环境中，客户端进程就可以通过`IP地址`+`端口号`的方式与这个进程连接。
				- 命名管道和共享内存
				  collapsed:: true
					- 在Windows环境中，我们可以使用**命名管道**和**共享内存**的方式进行通信。
					- MySQL使用**命名管道**来进行进程间通信
					  collapsed:: true
						- 需要在启动服务器程序的命令中加上`--enable-named-pipe`参数，然后在启动客户端程序的命令中加入`--pipe`或者`--protocol=pipe`参数。
					- MySQL使用共享内存来进行进程间通信
					  collapsed:: true
						- 前提是客户端和服务器端在同一台`Windows`主机中。
						- 在启动服务器程序的命令中加上`--shared-memory`参数，在成功启动服务器后，`共享内存`便成为本地客户端程序的默认连接方式，不过我们也可以在启动客户端程序的命令中加入`--protocol=memory`参数来显式的指定使用共享内存进行通信。
				- Unix域套接字文件
					- 前提是客户端和服务器端在同一台操作系统为类`Unix`的机器上。
					- 如果我们在启动客户端程序的时候指定的主机名为`localhost`，或者指定了`--protocol=socket`的启动参数，那服务器程序和客户端程序之间就可以通过`Unix`域套接字文件来进行通信了。
					- `MySQL`服务器程序默认监听的`Unix`域套接字文件路径为`/tmp/mysql.sock`，客户端程序也默认连接到这个`Unix`域套接字文件。
					- 指定Unix域套接字文件：`mysqld --socket=/tmp/a.txt`。
		- 4.服务器处理客户端请求
		  collapsed:: true
			- 客户端和服务器端通信的本质：客户端进程向服务器进程发送一段文本（MySQL语句），服务器进程处理后再向客户端进程发送一段文本（处理结果）。
			- 服务器端处理客户端查询请求的过程图
			  ![MySQL服务器端处理客户端查询请求.png](../assets/MySQL服务器端处理客户端查询请求_1688648318016_0.png)
			- 连接管理
				- 客户端采用 ((64a6b818-7479-426a-a175-fa24189a58ef))和服务器端建立连接。
				- 服务器端会专门创建一个线程来处理和客户端的交互。
				- 当客户端和服务器端断开连接之后，服务器端不会立刻把这个交互的线程销毁掉，而是把它缓存了起来。从而节省了开销，避免的线程的频繁创建和销毁。
			- 解析与优化
				- 查询缓存
				  collapsed:: true
					- 如果两个查询请求的字符串一样，就可以命中缓存，无需接着查询。
					- 如果两个查询请求在任何字符上的不同（例如：空格、注释、大小写），都会导致缓存不会命中。
					- 另外，如果查询请求中包含某些**系统函数**、**用户自定义变量**和**函数**、一**些系统表**，如 mysql 、information_schema、 performance_schema 数据库中的表，那这个请求就不会被缓存。
					- MySQL的缓存系统会监测涉及到的每张表，只要该表的结构或者数据被修改，如对该表使用了`INSERT`、 `UPDATE`、`DELETE`、`TRUNCATE TABLE`、`ALTER TABLE`、`DROP TABLE`或 `DROP DATABASE`语句，那使用该表的所有高速缓存查询都将变为无效并从高速缓存中删除！
				- 语法解析
				  collapsed:: true
					- 事实上这块内容涉及到了编译器的知识，会涉及到词法分析，语法分析，语义分析等步骤。
				- 查询优化
					- MySQL会对用户的sql进行优化。
			- 存储引擎
				- `MySQL`服务器把数据的存储和提取操作都封装到了一个叫`存储引擎`的模块里
				- 为了管理方便，人们把`连接管理`、`查询缓存`、`语法解析`、`查询优化`这些并不涉及真实数据存储的功能划分为`MySQL server`的功能，把真实存取数据的功能划分为`存储引擎`的功能。
				- 负责数据的提取和写入。
		- 5.常用的存储引擎
		  collapsed:: true
			- InnoDB：具备外键支持功能的事务存储引擎。
			- MyISAM：主要的非事务处理存储引擎。
		- 6.关于存储引擎的一些操作
		  collapsed:: true
			- 查看当前数据库支持的存储引擎
			  ```sql
			  SHOW ENGINES;
			  ```
			- 设置表的存储引擎
				- 存储引擎是负责对表中的数据进行提取和写入的，我们可以为不同的表设置不同的存储引擎，也就是说不同的表可以有不同的物理存储结构，不同的提取和写入方式。
			- 创建表时指定存储引擎
			  ```sql
			  CREATE TABLE 表名(
			      建表语句;
			  ) ENGINE = 存储引擎名称;
			  ```
			- 修改表的存储引擎
			  ```sql
			  ALTER TABLE 表名 ENGINE = 存储引擎名称;
			  ```